<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="controllers/uploads/icons8-video-64.ico" type="image/png">
    <link rel="stylesheet" href="updateAvatar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <title>Profile User</title>
</head>
<body>

    <div style="display: flex;">
        <div class="logo"> shareXvideos</div>

        <% if(data) { %>
            <a href="/userLogin">Home Page</a>
        <% } else { %>
            <a href="/">Home Page</a>
        <% } %>

        <ul>
            Topic
            <li><a href="/topicIT">IT</a></li>
            <li><a href="/topicMusic">Music</a></li>
            <li><a href="/topicGame">Game</a></li>
        </ul>

        
        <ul>
            <% if(data) { %>
                <li ><a href="/userProfile"><img src="<%= data.avatar%>" style="width: 40px; height: 40px"/></a><%= data.username%></li>
                <li class="signup"><a href="/logout">Logout</a></li>
                
            <% } else { %>
                <li class="signin"><a href="/login">Signin</a></li>
                <li class="signup"><a href="/register"><i class="fas fa-user"></i>Signup</a></li>
            <% } %>
        </ul>
    </div>

    <h1>Profile User</h1>
    <% if(data) { %>
        <ul>
            <li>Avatar :</li>
            <img src="<%=data.avatar%>" alt="Avatar" style="width: 300px;height:auto ;">
            
            <form class="form">
                <div class="custom-file">
                    <input type="file" class="custom-file__input" id="field-upload" name="avatar" required>
                    <label class="custom-file__label" for="field-upload">Choose Avatar</label>
                </div>
                <button id="update-button" type="button">Update</button></li> 
            </form>

            <li>Username :</li>
            <%=data.username%>
        </ul>
        <h3>List course liked</h3>
        <% for(var i=0; i < courseLike.length; i++) { %>      
            <li><button><a href="/deleteCourseLiked/<%=courseLike[i].course[0]._id%>">x</a></button><a href="/detail/<%=courseLike[i].course[0]._id%>"><%=courseLike[i].course[0].course_name%></a></li>
        <% } %>
    <% } else { %>
        
    <% } %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
</body>
</html>
<script type="text/javascript">
    $(function () {
        $('input[type="text"]').change(function () {
            this.value = $.trim(this.value);
        });
    });
    $(function () {
        $('#update-button').click(function () {
            const formData = new FormData();
            formData.append('avatar', $('input[type=file]')[0].files[0]);
            
            $.ajax({
                    type: 'POST',
                    data: formData,
                    url: '/updateProfile',
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        if (data == true) {
                            swal({
                                title: "Good job!",
                                text: "You clicked the button!",
                                icon: "success",
                                button: "Aww yiss!",
                            }).then(function () {
                                location.reload();
                            });

                        } else {
                            swal("Oh noes!", "The AJAX request failed!", "error");
                        }
                    },
                });
        })
    })    
</script>